package org.example;

import java.io.BufferedReader;
import java.io.File;
import java.io.IOException;
import java.io.InputStreamReader;
import java.util.ArrayList;
import java.util.List;

public class Health {
    int noOfServers;
    int startPort;
    Health(int noOfServers, int startPort) {
        this.noOfServers= noOfServers;
        this.startPort= startPort;
    }

    public static void main(String[] args) throws IOException {
        Health h= new Health(3, 8080);
        List<Integer> xyz= h.healthOfServer();
        System.out.println(xyz);
    }

    List<Integer> healthOfServer() throws IOException {
        int port= startPort;
        List<Integer> healthyServers = new ArrayList<>();
        for(int i= 0; i< noOfServers; i++) {
            //Send request
            Process p= sendRequest(port);
            String status= response(p);
            if(status.equals("200OK")) {
                healthyServers.add(port);
            }
            port++;
        } return healthyServers;
    }

    Process sendRequest(int port) throws IOException {
        String cmd= "curl http://localhost:"+port;
        ProcessBuilder processBuilder= new ProcessBuilder(cmd.split(" "));
        processBuilder.directory(new File("\\Users\\lenovo"));
        Process process = processBuilder.start();
        return process;
    }

    String response(Process process) throws IOException {
        StringBuilder response = new StringBuilder();
        try(BufferedReader reader = new BufferedReader(new InputStreamReader(process.getInputStream()));
        ) {
            String line;
            while ((line = reader.readLine()) != null) {
                response.append(line).append("\n");
            }
        } catch (IOException e) {
            e.printStackTrace();
        }
        try {
            process.waitFor();
        } catch (InterruptedException e) {
            e.printStackTrace();
        }
        return response.toString().split(" ")[1];
    }
}
































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































